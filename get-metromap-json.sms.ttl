# baseURI: http://metromap.politie.nl/service
# imports: http://metro.politie.nl
# imports: http://topbraid.org/sparqlmotionlib
# imports: http://uispin.org/swon
# imports: https://architecture.politie.nl/metromap/functions
# prefix: endpoint

@prefix ai: <http://archimate.politie.nl/instances/> .
@prefix archimate: <http://www.opengroup.org/xsd/archimate/3.0/> .
@prefix arg: <http://spinrdf.org/arg#> .
@prefix at3: <http://example.org/ontologies/new#> .
@prefix dbp: <http://dbpedia.org/property/> .
@prefix dbpo: <http://dbpedia.org/ontology/> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix dtype: <http://www.linkedmodel.org/schema/dtype#> .
@prefix endpoint: <http://metromap.politie.nl/service#> .
@prefix functions: <https://architecture.politie.nl/metromap/functions#> .
@prefix generate: <https://architecture.politie.nl/metromap/generate#> .
@prefix instance: <https:///architecture.politie.nl/metromap/instance#> .
@prefix m: <http://metro.politie.nl#> .
@prefix metadata: <http://topbraid.org/metadata#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix p3.0: <http://www.opengroup.org/xsd/archimate/3.0/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sam: <http://simplearchimatemodel.politie.nl/> .
@prefix sami: <http://simplearchimatemodel.politie.nl/instances> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix sm: <http://topbraid.org/sparqlmotion#> .
@prefix smf: <http://topbraid.org/sparqlmotionfunctions#> .
@prefix sml: <http://topbraid.org/sparqlmotionlib#> .
@prefix sp: <http://spinrdf.org/sp#> .
@prefix spif: <http://spinrdf.org/spif#> .
@prefix spin: <http://spinrdf.org/spin#> .
@prefix spinx: <http://spinrdf.org/spinx#> .
@prefix spl: <http://spinrdf.org/spl#> .
@prefix swon: <http://uispin.org/swon#> .
@prefix teamwork: <http://topbraid.org/teamwork#> .
@prefix ui: <http://uispin.org/ui#> .
@prefix vaem: <http://www.linkedmodel.org/schema/vaem#> .
@prefix voag: <http://voag.linkedmodel.org/voag#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

<http://metromap.politie.nl/service>
  a owl:Ontology ;
  owl:imports <http://metro.politie.nl> ;
  owl:imports <http://topbraid.org/sparqlmotionlib> ;
  owl:imports <http://uispin.org/swon> ;
  owl:imports <https://architecture.politie.nl/metromap/functions> ;
  owl:versionInfo "simple example for sparqlMotion" ;
.
endpoint:ApplyTopSPIN_1
  a sml:ApplyTopSPIN ;
  sm:next endpoint:ReturnSWPDocument_1 ;
  sm:nodeX 392 ;
  sm:nodeY 907 ;
  sml:flatten true ;
  sml:predicate spin:rule ;
  sml:replace false ;
  sml:singlePass false ;
  rdfs:label "Apply top SPIN 1" ;
.
endpoint:ImportRDFFromWorkspace_1
  a sml:ImportRDFFromWorkspace ;
  sm:nodeX 55 ;
  sm:nodeY 433 ;
  sml:ignoreImports false ;
  sml:sourceFilePath "generate-metromap.ttl" ;
  rdfs:label "Import RDFFrom workspace 1" ;
.
endpoint:ImportRDFFromWorkspace_2
  a sml:ImportRDFFromWorkspace ;
  sm:next endpoint:ApplyTopSPIN_1 ;
  sm:nodeX 249 ;
  sm:nodeY 669 ;
  sml:baseURI "{?workspace}" ;
  sml:ignoreImports false ;
  rdfs:label "Import RDFFrom workspace 2" ;
.
endpoint:ImportRDFFromWorkspace_3
  a sml:ImportRDFFromWorkspace ;
  sm:next endpoint:ApplyTopSPIN_1 ;
  sm:nodeX 862 ;
  sm:nodeY 133 ;
  sml:ignoreImports false ;
  sml:sourceFilePath "generate-metromap.ttl" ;
.
endpoint:ReturnSWPDocument_1
  a sml:ReturnSWPDocument ;
  sm:nodeX 352 ;
  sm:nodeY 1077 ;
  sml:snippet true ;
  sml:view [
      a swon:Object ;
      ui:child [
          a swon:Values ;
          arg:name "metromap" ;
          ui:child [
              a ui:forEach ;
              ui:child [
                  a swon:Object ;
                  ui:child [
                      a swon:Value ;
                      arg:name "group" ;
                      arg:value [
                          a ui:label ;
                          sp:arg1 [
                              sp:varName "nodeType" ;
                            ] ;
                        ] ;
                      ui:childIndex 0 ;
                    ] ;
                  ui:child [
                      a ui:CommentNode ;
                      ui:childIndex 3 ;
                      rdfs:comment """
					{ group: 'nodes', data: { id: 'teruggave beslag', color: 'black',  foo: 10} }
		  			{ group: 'edges', data: { id: 'beheren beslag-goed-bvh', source: 'beheren beslag', target: 'goed', color: 'green' } },
				""" ;
                    ] ;
                  ui:child [
                      a ui:else ;
                      ui:child [
                          a swon:Value ;
                          arg:name "data" ;
                          ui:child [
                              a swon:Value ;
                              arg:name "color" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "color" ;
                                    ] ;
                                ] ;
                              ui:childIndex 2 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "id" ;
                              arg:value [
                                  a sp:concat ;
                                  sp:arg1 [
                                      sp:varName "id" ;
                                    ] ;
                                  sp:arg2 [
                                      a sp:rand ;
                                    ] ;
                                ] ;
                              ui:childIndex 1 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "label" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "label" ;
                                    ] ;
                                ] ;
                              ui:childIndex 3 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "source" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "source" ;
                                    ] ;
                                ] ;
                              ui:childIndex 5 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "style" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "style" ;
                                    ] ;
                                ] ;
                              ui:childIndex 4 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "target" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "target" ;
                                    ] ;
                                ] ;
                              ui:childIndex 6 ;
                            ] ;
                          ui:child [
                              a ui:TextNode ;
                              ui:childIndex 0 ;
                              ui:text "{" ;
                            ] ;
                          ui:child [
                              a ui:TextNode ;
                              ui:childIndex 7 ;
                              ui:text """}
						""" ;
                            ] ;
                          ui:childIndex 0 ;
                        ] ;
                      ui:childIndex 2 ;
                    ] ;
                  ui:child [
                      a ui:if ;
                      ui:child [
                          a swon:Value ;
                          arg:name "data" ;
                          ui:child [
                              a swon:Value ;
                              arg:name "bar" ;
                              arg:value 0 ;
                              ui:childIndex 6 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "bax" ;
                              arg:value 0 ;
                              ui:childIndex 8 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "baz" ;
                              arg:value 0 ;
                              ui:childIndex 7 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "color" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "color" ;
                                    ] ;
                                ] ;
                              ui:childIndex 2 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "documentation" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "documentation" ;
                                    ] ;
                                ] ;
                              ui:childIndex 4 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "foo" ;
                              arg:value 10 ;
                              ui:childIndex 5 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "id" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "id" ;
                                    ] ;
                                ] ;
                              ui:childIndex 1 ;
                            ] ;
                          ui:child [
                              a swon:Value ;
                              arg:name "version" ;
                              arg:value [
                                  a ui:label ;
                                  sp:arg1 [
                                      sp:varName "version" ;
                                    ] ;
                                ] ;
                              ui:childIndex 3 ;
                            ] ;
                          ui:child [
                              a ui:TextNode ;
                              ui:childIndex 0 ;
                              ui:text "{" ;
                            ] ;
                          ui:child [
                              a ui:TextNode ;
                              ui:childIndex 9 ;
                              ui:text """}
						""" ;
                            ] ;
                          ui:childIndex 0 ;
                        ] ;
                      ui:childIndex 1 ;
                      ui:condition [
                          a sp:eq ;
                          sp:arg1 [
                              sp:varName "nodeType" ;
                            ] ;
                          sp:arg2 "nodes" ;
                        ] ;
                    ] ;
                  ui:childIndex 0 ;
                ] ;
              ui:childIndex 0 ;
              ui:resultSet [
                  a sp:Select ;
                  sp:resultVariables (
                      [
                        sp:varName "id" ;
                      ]
                      [
                        sp:varName "source" ;
                      ]
                      [
                        sp:varName "target" ;
                      ]
                      [
                        sp:varName "class" ;
                      ]
                      [
                        sp:varName "nodeType" ;
                      ]
                      [
                        sp:varName "color" ;
                      ]
                      [
                        sp:varName "version" ;
                      ]
                      [
                        sp:varName "documentation" ;
                      ]
                      [
                        sp:varName "style" ;
                      ]
                      [
                        sp:varName "label" ;
                      ]
                    ) ;
                  sp:where (
                      [
                        a sp:Union ;
                        sp:elements (
                            (
                              [
                                sp:object m:L ;
                                sp:predicate rdf:type ;
                                sp:subject [
                                    sp:varName "id" ;
                                  ] ;
                              ]
                              [
                                sp:object [
                                    sp:varName "id" ;
                                  ] ;
                                sp:predicate m:T ;
                                sp:subject [
                                    sp:varName "source" ;
                                  ] ;
                              ]
                              [
                                sp:object [
                                    sp:varName "target" ;
                                  ] ;
                                sp:predicate m:T ;
                                sp:subject [
                                    sp:varName "id" ;
                                  ] ;
                              ]
                              [
                                sp:object [
                                    sp:varName "target" ;
                                  ] ;
                                sp:predicate sam:D ;
                                sp:subject [
                                    sp:varName "source" ;
                                  ] ;
                              ]
                              [
                                sp:object [
                                    sp:varName "label" ;
                                  ] ;
                                sp:predicate rdfs:label ;
                                sp:subject [
                                    sp:varName "id" ;
                                  ] ;
                              ]
                              [
                                a sp:Bind ;
                                sp:expression [
                                    a functions:getColor ;
                                    sp:arg1 [
                                        sp:varName "label" ;
                                      ] ;
                                  ] ;
                                sp:variable [
                                    sp:varName "color" ;
                                  ] ;
                              ]
                              [
                                a sp:Bind ;
                                sp:expression [
                                    a functions:getStyle ;
                                    sp:arg1 [
                                        sp:varName "id" ;
                                      ] ;
                                  ] ;
                                sp:variable [
                                    sp:varName "style" ;
                                  ] ;
                              ]
                              [
                                a sp:Filter ;
                                sp:expression [
                                    a sp:ne ;
                                    sp:arg1 [
                                        sp:varName "source" ;
                                      ] ;
                                    sp:arg2 [
                                        sp:varName "target" ;
                                      ] ;
                                  ] ;
                              ]
                            )
                            (
                              [
                                sp:object m:S ;
                                sp:predicate rdf:type ;
                                sp:subject [
                                    sp:varName "id" ;
                                  ] ;
                              ]
                              [
                                a sp:Optional ;
                                sp:elements (
                                    [
                                      sp:object [
                                          sp:varName "version" ;
                                        ] ;
                                      sp:predicate sam:version ;
                                      sp:subject [
                                          sp:varName "id" ;
                                        ] ;
                                    ]
                                  ) ;
                              ]
                              [
                                a sp:Optional ;
                                sp:elements (
                                    [
                                      sp:object [
                                          sp:varName "documentation" ;
                                        ] ;
                                      sp:predicate sam:documentation ;
                                      sp:subject [
                                          sp:varName "id" ;
                                        ] ;
                                    ]
                                  ) ;
                              ]
                              [
                                a sp:Bind ;
                                sp:expression "black" ;
                                sp:variable [
                                    sp:varName "color" ;
                                  ] ;
                              ]
                            )
                          ) ;
                      ]
                      [
                        sp:object [
                            sp:varName "class" ;
                          ] ;
                        sp:predicate rdf:type ;
                        sp:subject [
                            sp:varName "id" ;
                          ] ;
                      ]
                      [
                        sp:object [
                            sp:varName "nodeType" ;
                          ] ;
                        sp:predicate rdfs:label ;
                        sp:subject [
                            sp:varName "class" ;
                          ] ;
                      ]
                      [
                        a sp:Filter ;
                        sp:expression [
                            a sp:or ;
                            sp:arg1 [
                                a sp:eq ;
                                sp:arg1 [
                                    sp:varName "class" ;
                                  ] ;
                                sp:arg2 m:S ;
                              ] ;
                            sp:arg2 [
                                a sp:eq ;
                                sp:arg1 [
                                    sp:varName "class" ;
                                  ] ;
                                sp:arg2 m:L ;
                              ] ;
                          ] ;
                      ]
                    ) ;
                ] ;
              ui:separator "," ;
            ] ;
          ui:childIndex 0 ;
        ] ;
    ] ;
  rdfs:label "Return SWPDocument 1" ;
.
endpoint:begrippenkader
  a owl:DatatypeProperty ;
  rdfs:label "debug" ;
.
endpoint:buildString_1
  a spif:buildString ;
  sp:arg1 [
      a sp:concat ;
      sp:arg1 "urn:x-evn-master:" ;
      sp:arg2 [
          sp:varName "debug" ;
        ] ;
    ] ;
  sm:next endpoint:ImportRDFFromWorkspace_2 ;
  sm:nodeX 272 ;
  sm:nodeY 361 ;
  sm:outputVariable "workspace" ;
  rdfs:label "build string 1" ;
.
endpoint:metromap
  a spin:Function ;
  spin:constraint [
      a spl:Argument ;
      spl:defaultValue "metromap_identificatie" ;
      spl:optional false ;
      spl:predicate endpoint:debug ;
      spl:valueType xsd:string ;
      sm:next endpoint:buildString_1 ;
      sm:nodeX 189 ;
      sm:nodeY 90 ;
      sml:hidden true ;
    ] ;
  sm:returnModule endpoint:ReturnSWPDocument_1 ;
  rdfs:comment "http://localhost:8083/tbl/sparqlmotion?id=metromap" ;
  rdfs:comment "the instance name is used as idenifier for the request" ;
  rdfs:label "request" ;
  rdfs:subClassOf sm:Functions ;
.
